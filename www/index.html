<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Car Share Fare</title>
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png" />
    <style>
      body {
        padding: 1rem;
      }

      * {
        font-size: 1.2rem;
        margin-bottom: 0.5rem;
      }

      @media (max-width: 576px) {
        input,
        button {
          width: 100%;
        }
      }

      .results__title {
        line-height: 2rem;
        border-bottom: 1px solid #ddd;
      }
      #results th {
        text-align: left;
        padding-right: 1rem;
      }
      .results__disclaimer {
        color: #777;
        font-size: 0.8rem;
      }
    </style>
  </head>
  <body>
    <form>
      <div>
        <label>Time (mins) <input id="minutesInput" type="number" autofocus min="0"/></label>
      </div>
      <div>
        <label>Distance (km) <input id="distanceInput" type="number" min="0"/></label>
      </div>
      <button id="calculateButton">Go</button>
    </form>
    <div id="results" hidden>
        <h3 class="results__title">Costs</h3>
        <div id="results__table"></div>
        <small class="results__disclaimer">* Costs do not include tax.</small>
    </div>
  </body>
  <script type="module">
    import { computeCosts } from './car-share-fare.es.production.js';

    const button = document.querySelector('#calculateButton');
    button.addEventListener('click', calculate);

    const minutes = document.querySelector('#minutesInput');
    const distance = document.querySelector('#distanceInput');
    const resultsTable = document.querySelector('#results__table');
    const resultsSection = document.querySelector('#results');

    function calculate(event) {
      event.preventDefault();
      const costComparison = computeCosts(minutes.value, distance.value);
      console.log(costComparison);
      const formatted = Object.keys(costComparison).map(key => {
        return { key, cost: parseFloat(costComparison[key].total).toFixed(2) };
      });
      resultsTable.innerHTML = buildResultsTable(formatted);
      resultsSection.removeAttribute('hidden');
    }

    function buildResultsTable(data) {
      const rowData =
        data.map(row => {
          return `<tr><th>${row.key}</th><td>$${row.cost}</td></tr>`;
        })
        .join('\n');
      return `<table><tbody>${rowData}</tbody></table>`;
    }
  </script>
</html>
